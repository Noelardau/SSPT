import{a as s,x as C,w as o,J as x,u as t,f as T,g as E,aX as X,e as k,m as _,t as w,c as g,b as a,k as L,l as y,d as N,p as Y,r as v,F as B,o as j,A as $,T as A,z as q,i as I,j as G,aY as H,s as Q,n as W}from"./index-509092f4.js";import{a as R}from"./Axios-26df80cc.js";/* empty css                                             */import{V as Z,a as ee}from"./VRow-c34e05e9.js";import{V as te}from"./VSnackbar-ac0695fb.js";import{V as z,a as ne}from"./VTextField-fd3c325b.js";import"./_commonjsHelpers-39b5b250.js";let le=V=>V.length==0?1:V[V.length-1]._id+1;const oe={align:"center"},ae={key:0,style:{color:"red"}},re={key:0},se={__name:"Note",props:{note:Object,annulable:{type:Boolean,default:!0}},emits:["annulerNote","retirerPrendre"],setup(V,{emit:P}){const e=V;let d=c=>P("annulerNote",c),i=c=>{P("retirerPrendre",c)};return(c,u)=>(s(),C(N,{"max-width":"200"},{default:o(()=>[V.annulable?(s(),C(x,{key:0,icon:"mdi-close",color:"red",onClick:u[0]||(u[0]=f=>t(d)(t(e).note._id))})):T("",!0),t(e).penalite?T("",!0):(s(),C(E,{key:1,class:X(t(e).note.retenu?"pris":"nonPris")},{default:o(()=>[k("p",oe,[_(w(t(e).note.note)+" ",1),t(e).note.penalite?(s(),g("span",ae,"(Penalité)")):T("",!0)])]),_:1},8,["class"])),a(L,{center:""},{default:o(()=>[t(e).note.penalite?T("",!0):(s(),g("div",re,[t(e).note.retenu?(s(),C(y,{key:0,color:"red",onClick:u[1]||(u[1]=f=>t(i)(t(e).note._id))},{default:o(()=>[_("Retirer")]),_:1})):(s(),C(y,{key:1,color:"green",onClick:u[2]||(u[2]=f=>t(i)(t(e).note._id))},{default:o(()=>[_("Prendre")]),_:1}))]))]),_:1})]),_:1}))}},ie={class:"text-h4"},ue={__name:"Timer",emits:["updateTime"],setup(V,{emit:P}){let e=Y({h:0,min:0,sec:0}),d=()=>{c.value=`${e.h<10?"0"+e.h:e.h}:${e.min<10?"0"+e.min:e.min}:${e.sec<10?"0"+e.sec:e.sec}`},i=v(!1),c=v(`${e.h<10?"0"+e.h:e.h}:${e.min<10?"0"+e.min:e.min}:${e.sec<10?"0"+e.sec:e.sec}`),u=null,f=()=>{i.value=!0,u=setInterval(()=>{e.sec++,e.sec>59&&(e.sec=0,e.min++),d(),P("updateTime",c.value)},1e3)},b=()=>{i.value=!1,clearInterval(u)},F=()=>{b(),e.h=0,e.min=0,e.sec=0,d()};return(h,r)=>(s(),g(B,null,[k("div",ie,w(t(c)),1),a(y,{onClick:t(F)},{default:o(()=>[a(x,{icon:"mdi-restart"})]),_:1},8,["onClick"]),t(i)?(s(),C(y,{key:1,onClick:t(b)},{default:o(()=>[a(x,{icon:"mdi-pause"})]),_:1},8,["onClick"])):(s(),C(y,{key:0,onClick:t(f)},{default:o(()=>[a(x,{icon:"mdi-play"})]),_:1},8,["onClick"]))],64))}},de={key:0,align:"center"},pe={class:"text-h4"},me=k("br",null,null,-1),ce={key:0,class:"text-h8 text-red"},fe={key:1,class:"text-h8 text-blue"},ve=k("br",null,null,-1),_e=k("br",null,null,-1),ke=k("br",null,null,-1),he=k("br",null,null,-1),ge={key:1},$e={__name:"Performance",setup(V){j(()=>{R.get("/api.poete/findOne/"+$().params.idPoete).then(n=>{e.value=n.data.body}),R.get("/api.tournoi/get/"+$().params.idTournoi).then(n=>{d.value=n.data,r.value._id=le(d.value.performances)})});let P=v(!0);var e=v({}),d=v({});let i=v(!1),c=v("Performance enregistré"),u=n=>{c.value=n,i.value=!i.value},f=v(!1),b=()=>f.value=!f.value,F=A(()=>!!f.value),h=v({note:null,retenu:!0,penalite:F}),r=v({notes:[],idPoete:parseInt($().params.idPoete),duree:"00:00:00"}),U=A(()=>{let n={note:r.value.notes};for(var l=0;l<n.note.length;l++)for(var p=l+1;p<n.note.length;p++){var m=n.note[l];parseFloat(m.note)>parseFloat(n.note[p].note)&&(n.note[l]=n.note[p],n.note[p]=m,m=n.note[p])}return n.note}),D=n=>{r.value.duree=n},S=()=>{if(h.value.note!=null)if(h.value.note<=10){var n={_id:new Date().getTime()+new Date().getSeconds().toString(),note:h.value.note,retenu:h.value.retenu,penalite:h.value.penalite};n.penalite?r.value.notes=[...r.value.notes,n]:r.value.notes.filter(l=>l.penalite==!1).length<d.value.nbJury?r.value.notes=[...r.value.notes,n]:u("Les notes sont déjà complet!!!")}else u("Note incohérent !!");else u("Veuillez mettre la note!!!");h.value.note=null,console.log(r.value.notes)},J=n=>{r.value.notes=r.value.notes.filter(l=>l._id!=n)},K=n=>{r.value.notes.forEach(l=>{l._id==n&&(l.retenu=!l.retenu)})},M=n=>{let l=0;return n.forEach(p=>{p.retenu&&(p.penalite?l-=parseFloat(p.note):l+=parseFloat(p.note))}),l},O=()=>{r.value.notes.filter(n=>!n.penalite).length==d.value.nbJury?(r.value.noteFinal=M(r.value.notes),console.log(r.value),d.value.performances=[...d.value.performances,r.value],console.log(d.value.performances),R.post("/api.tournoi/update",d.value).then(n=>{u("Performance enregistrée!!"),setTimeout(()=>{W.push({name:"listParticipants",params:{idTournoi:d.value._id}})},1500)})):u("Veuillez mettre toute les notes des jurys!!!")};return(n,l)=>{const p=q("RouterLink");return s(),g(B,null,[t(P)?(s(),g("div",de,[k("div",null,[a(N,null,{default:o(()=>[k("h1",pe,w(t(e).pseudoPoete),1),a(z,null,{default:o(()=>[a(ue,{onUpdateTime:t(D)},null,8,["onUpdateTime"])]),_:1})]),_:1}),me,a(N,{"max-width":"300"},{default:o(()=>[a(z,{onSubmit:l[1]||(l[1]=G(()=>{},["prevent"]))},{default:o(()=>[a(ne,{label:t(f)?"Pénalité":"Note",type:"number",modelValue:t(h).note,"onUpdate:modelValue":l[0]||(l[0]=m=>t(h).note=m),onKeypress:H(t(S),["enter"])},null,8,["label","modelValue","onKeypress"]),a(y,{onClick:t(S)},{default:o(()=>[_("Ajouter")]),_:1},8,["onClick"])]),_:1}),k("div",{style:{"margin-top":"20px",cursor:"pointer"},onClick:l[2]||(l[2]=m=>t(b)())},[t(f)?(s(),g("span",fe,"Note?")):(s(),g("span",ce,"Penalité?"))])]),_:1}),_(),ve,_e,a(Z,null,{default:o(()=>[(s(!0),g(B,null,Q(t(U),m=>(s(),C(ee,null,{default:o(()=>[a(se,{note:m,onAnnulerNote:t(J),onRetirerPrendre:t(K)},null,8,["note","onAnnulerNote","onRetirerPrendre"])]),_:2},1024))),256))]),_:1}),ke,he,a(y,{color:"primary",onClick:t(O)},{default:o(()=>[_(" Enregistrer")]),_:1},8,["onClick"])])])):(s(),g("div",ge,[a(N,null,{default:o(()=>[a(E,null,{default:o(()=>[_("Performance enregistrée!!!")]),_:1}),a(L,{center:""},{default:o(()=>[a(y,{color:"primary"},{default:o(()=>[a(x,{icon:"mdi-arrow-left"}),a(p,{to:{name:"listParticipants",params:{idTournoi:t($)().params.idTournoi}}},{default:o(()=>[_(" Revenir à la liste des participants")]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})])),a(te,{modelValue:t(i),"onUpdate:modelValue":l[4]||(l[4]=m=>I(i)?i.value=m:i=m),timeout:1e3},{actions:o(()=>[a(y,{color:"blue",variant:"text",onClick:l[3]||(l[3]=m=>I(i)?i.value=!1:i=!1)},{default:o(()=>[_(" Close ")]),_:1})]),default:o(()=>[_(w(t(c))+" ",1)]),_:1},8,["modelValue"])],64)}}};export{$e as default};
