import{a as i,x as C,w as a,b as o,J as x,u as t,g as z,aX as O,m as v,t as $,c as h,f as F,k as E,l as g,d as N,p as X,r as _,e as y,F as S,o as Y,A as b,T as j,z as q,i as A,j as G,aY as H,s as Q,n as W}from"./index-c03ad22d.js";import{a as R}from"./Axios-26df80cc.js";import{V as Z,a as ee}from"./VRow-d1a45d3a.js";import{V as te}from"./VSnackbar-8af6d896.js";import{V as I,a as ne}from"./VTextField-cd27eaa2.js";import"./_commonjsHelpers-39b5b250.js";let le=V=>V.length==0?1:V[V.length-1]._id+1;const oe={key:0,style:{color:"red"}},ae={key:0},re={__name:"Note",props:{note:Object},emits:["annulerNote","retirerPrendre"],setup(V,{emit:P}){const e=V;let d=m=>P("annulerNote",m),s=m=>{P("retirerPrendre",m)};return(m,u)=>(i(),C(N,{"max-width":"200"},{default:a(()=>[o(x,{icon:"mdi-close",color:"red",onClick:u[0]||(u[0]=f=>t(d)(t(e).note._id))}),t(e).penalite?F("",!0):(i(),C(z,{key:0,class:O(t(e).note.retenu?"pris":"nonPris")},{default:a(()=>[v($(t(e).note.note)+" ",1),t(e).note.penalite?(i(),h("span",oe,"(Penalité)")):F("",!0)]),_:1},8,["class"])),o(E,{center:""},{default:a(()=>[t(e).note.penalite?F("",!0):(i(),h("div",ae,[t(e).note.retenu?(i(),C(g,{key:0,color:"red",onClick:u[1]||(u[1]=f=>t(s)(t(e).note._id))},{default:a(()=>[v("Retirer")]),_:1})):(i(),C(g,{key:1,color:"green",onClick:u[2]||(u[2]=f=>t(s)(t(e).note._id))},{default:a(()=>[v("Prendre")]),_:1}))]))]),_:1})]),_:1}))}},se={class:"text-h4"},ie={__name:"Timer",emits:["updateTime"],setup(V,{emit:P}){let e=X({h:0,min:0,sec:0}),d=()=>{m.value=`${e.h<10?"0"+e.h:e.h}:${e.min<10?"0"+e.min:e.min}:${e.sec<10?"0"+e.sec:e.sec}`},s=_(!1),m=_(`${e.h<10?"0"+e.h:e.h}:${e.min<10?"0"+e.min:e.min}:${e.sec<10?"0"+e.sec:e.sec}`),u=null,f=()=>{s.value=!0,u=setInterval(()=>{e.sec++,e.sec>59&&(e.sec=0,e.min++),d(),P("updateTime",m.value)},1e3)},T=()=>{s.value=!1,clearInterval(u)},w=()=>{T(),e.h=0,e.min=0,e.sec=0,d()};return(k,r)=>(i(),h(S,null,[y("div",se,$(t(m)),1),o(g,{onClick:t(w)},{default:a(()=>[o(x,{icon:"mdi-restart"})]),_:1},8,["onClick"]),t(s)?(i(),C(g,{key:1,onClick:t(T)},{default:a(()=>[o(x,{icon:"mdi-pause"})]),_:1},8,["onClick"])):(i(),C(g,{key:0,onClick:t(f)},{default:a(()=>[o(x,{icon:"mdi-play"})]),_:1},8,["onClick"]))],64))}},ue={key:0,align:"center"},de={class:"text-h4"},pe=y("br",null,null,-1),ce={key:0,class:"text-h8 text-red"},me={key:1,class:"text-h8 text-blue"},fe=y("br",null,null,-1),_e=y("br",null,null,-1),ve=y("br",null,null,-1),ke=y("br",null,null,-1),he={key:1},Te={__name:"Performance",setup(V){Y(()=>{R.get("/api.poete/findOne/"+b().params.idPoete).then(n=>{e.value=n.data.body}),R.get("/api.tournoi/get/"+b().params.idTournoi).then(n=>{d.value=n.data,r.value._id=le(d.value.performances)})});let P=_(!0);var e=_({}),d=_({});let s=_(!1),m=_("Performance enregistré"),u=n=>{m.value=n,s.value=!s.value},f=_(!1),T=()=>f.value=!f.value,w=j(()=>!!f.value),k=_({note:null,retenu:!0,penalite:w}),r=_({notes:[],idPoete:parseInt(b().params.idPoete),duree:"00:00:00"});function L(){let n={note:r.value.notes};for(var l=0;l<n.note.length;l++)for(var p=l+1;p<n.note.length;p++){var c=n.note[l];parseFloat(c.note)>parseFloat(n.note[p].note)&&(n.note[l]=n.note[p],n.note[p]=c,c=n.note[p])}return n.note}let U=n=>{r.value.duree=n},B=()=>{if(k.value.note!=null)if(k.value.note<=10){var n={_id:new Date().getTime()+new Date().getSeconds().toString(),note:k.value.note,retenu:k.value.retenu,penalite:k.value.penalite};n.penalite?r.value.notes=[...r.value.notes,n]:r.value.notes.filter(l=>l.penalite==!1).length<d.value.nbJury?r.value.notes=[...r.value.notes,n]:u("Les notes sont déjà complet!!!")}else u("Note incohérent !!");else u("Veuillez mettre la note!!!");k.value.note=null,console.log(r.value.notes)},D=n=>{r.value.notes=r.value.notes.filter(l=>l._id!=n)},J=n=>{r.value.notes.forEach(l=>{l._id==n&&(l.retenu=!l.retenu)})},K=n=>{let l=0;return n.forEach(p=>{p.retenu&&(p.penalite?l-=parseFloat(p.note):l+=parseFloat(p.note))}),l},M=()=>{r.value.notes.filter(n=>!n.penalite).length==d.value.nbJury?(r.value.noteFinal=K(r.value.notes),console.log(r.value),d.value.performances=[...d.value.performances,r.value],console.log(d.value.performances),R.post("/api.tournoi/update",d.value).then(n=>{u("Performance enregistrée!!"),setTimeout(()=>{W.push({name:"listParticipants",params:{idTournoi:d.value._id}})},1500)})):u("Veuillez mettre toute les notes des jurys!!!")};return(n,l)=>{const p=q("RouterLink");return i(),h(S,null,[t(P)?(i(),h("div",ue,[y("div",null,[o(N,null,{default:a(()=>[y("h1",de,$(t(e).pseudoPoete),1),o(I,null,{default:a(()=>[o(ie,{onUpdateTime:t(U)},null,8,["onUpdateTime"])]),_:1})]),_:1}),pe,o(N,{"max-width":"300"},{default:a(()=>[o(I,{onSubmit:l[1]||(l[1]=G(()=>{},["prevent"]))},{default:a(()=>[o(ne,{label:t(f)?"Pénalité":"Note",type:"number",modelValue:t(k).note,"onUpdate:modelValue":l[0]||(l[0]=c=>t(k).note=c),onKeypress:H(t(B),["enter"])},null,8,["label","modelValue","onKeypress"]),o(g,{onClick:t(B)},{default:a(()=>[v("Ajouter")]),_:1},8,["onClick"])]),_:1}),y("div",{style:{"margin-top":"20px",cursor:"pointer"},onClick:l[2]||(l[2]=c=>t(T)())},[t(f)?(i(),h("span",me,"Note?")):(i(),h("span",ce,"Penalité?"))])]),_:1}),v(),fe,_e,o(Z,null,{default:a(()=>[(i(!0),h(S,null,Q(L(),c=>(i(),C(ee,null,{default:a(()=>[o(re,{note:c,onAnnulerNote:t(D),onRetirerPrendre:t(J)},null,8,["note","onAnnulerNote","onRetirerPrendre"])]),_:2},1024))),256))]),_:1}),ve,ke,o(g,{color:"primary",onClick:t(M)},{default:a(()=>[v(" Enregistrer")]),_:1},8,["onClick"])])])):(i(),h("div",he,[o(N,null,{default:a(()=>[o(z,null,{default:a(()=>[v("Performance enregistrée!!!")]),_:1}),o(E,{center:""},{default:a(()=>[o(g,{color:"primary"},{default:a(()=>[o(x,{icon:"mdi-arrow-left"}),o(p,{to:{name:"listParticipants",params:{idTournoi:t(b)().params.idTournoi}}},{default:a(()=>[v(" Revenir à la liste des participants")]),_:1},8,["to"])]),_:1})]),_:1})]),_:1})])),o(te,{modelValue:t(s),"onUpdate:modelValue":l[4]||(l[4]=c=>A(s)?s.value=c:s=c),timeout:1e3},{actions:a(()=>[o(g,{color:"blue",variant:"text",onClick:l[3]||(l[3]=c=>A(s)?s.value=!1:s=!1)},{default:a(()=>[v(" Close ")]),_:1})]),default:a(()=>[v($(t(m))+" ",1)]),_:1},8,["modelValue"])],64)}}};export{Te as default};
